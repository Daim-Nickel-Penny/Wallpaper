 /* 
 * Wallpaper - Adds a smooth-scaling, page-filling background
 * @author Ben Plum <benjaminplum@gmail.com>
 * @version 1.0
 *
 * Copyright (c) 2012 Ben Plum <ben@benjaminplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */

(function(c){var b={file:null,fitting:"window",speed:"500",minWidth:!1,onReady:function(){},onLoad:function(){}},e={init:function(a){b=c.extend(b,a);a=c("body");1>a.find("#wallpaper").length&&("document"==b.fitting&&(a.wrapInner('<div id="wallpaper_content" style="overflow: hidden; position: relative;"></div>'),b.$content=c("wallpaper_content")),a.append('<div id="wallpaper"></div>'),b.$wallpaper=c("#wallpaper"),b.$wallpaper.css({overflow:"hidden",minWidth:b.minWidth,top:0,width:"100%",zIndex:-1}), "document"==b.fitting?b.$wallpaper.css({position:"absolute"}):b.$wallpaper.css({height:"100%",position:"fixed"}),c(window).on("resize",e._resize),e._loadImage(b.file),b.onReady.call())},update:function(a){e._loadImage(a)},_loadImage:function(a){if(b.$wallpaper.find("img").attr("src")!=a){var d=c("<img />");d.load(function(){1>b.$wallpaper.find("img").length?d.appendTo(b.$wallpaper):d.css({opacity:0,"-webkit-transition":"none","-moz-transition":"none","-o-transition":"none","-ms-transition":"none", transition:"none"}).appendTo(b.$wallpaper).animate({opacity:1},b.speed,function(){b.$wallpaper.find("img").not(":last").remove()});d.css({left:"0",position:"absolute",top:"0"});e._doResize(d);b.onLoad.call()}).attr("src",a);d[0].complete&&d.trigger("load")}},_resize:function(){c("#wallpaper img").each(function(){e._doResize(c(this))})},_doResize:function(a){var d=e._computeSize(a);if(0<a.length){if("window"==b.fitting){var g=c(window).height();a.css({top:-d.top})}else{var f=c(document).height(),h= c(window).height(),g=b.$content.outerHeight(!0);g<f&&(g=f);h>g&&(g=h)}a.css({height:d.height,width:d.width,left:-d.left,top:-d.top});b.$wallpaper.css({height:g})}},_computeSize:function(a){var d=c(window).width(),e="document"==b.fitting?c(document).height():c(window).height(),f=a[0].width,a=a[0].height,h=f/a,i=0,j=0,a=e,f=a*h;f<d&&(f=d,a=f/h);i=(f-d)/2;j=(a-e)/2;"window"==b.fitting&&0<c(document).scrollLeft()&&(i+=c(document).scrollLeft());return{width:parseInt(f,10),height:parseInt(a,10),left:parseInt(i, 10),top:parseInt(j,10)}}};c.wallpaper=function(a){if(e[a])return e[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return e.init.apply(this,arguments);c.error("WALLPAPER: '"+a+"' does not exist.")}})(jQuery);