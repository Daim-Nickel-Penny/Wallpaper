 /* 
 * Wallpaper - Adds a smooth-scaling, page-filling background
 * @author Ben Plum <benjaminplum@gmail.com>
 * @version 1.0
 *
 * Copyright (c) 2012 Ben Plum <ben@benjaminplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */

(function(b){var e={file:null,fitting:"window",speed:"500",easing:"linear",minWidth:!1,onReady:function(){},onLoad:function(){}},d={init:function(a){e=b.extend(e,a);a=b("body");1>a.find("#wallpaper").length&&(a.wrapInner('<div id="wallpaper_content" style="overflow: hidden; position: relative;"></div>').append('<div id="wallpaper"></div>'),a=b("#wallpaper"),a.css({overflow:"hidden",minWidth:e.minWidth,top:0,width:"100%",zIndex:-1}),"document"==e.fitting?a.css({position:"absolute"}):a.css({height:"100%", position:"fixed"}),b(window).on("resize",d._resize),d._loadImage(e.file),e.onReady.call())},update:function(a){d._loadImage(a)},_loadImage:function(a){var c=b("#wallpaper");if(c.find("img").attr("src")!=a){var f=b("<img />");f.load(function(){1>c.find("img").length?f.appendTo(c):f.css({opacity:0,"-webkit-transition":"none","-moz-transition":"none","-o-transition":"none","-ms-transition":"none",transition:"none"}).appendTo(c).animate({opacity:1},e.speed,e.easing,function(){c.find("img").not(":last").remove()}); f.css({left:"0",position:"absolute",top:"0"});d._doResize(f);e.onLoad.call()}).attr("src",a)}},_resize:function(){b("#wallpaper img").each(function(){d._doResize(b(this))})},_doResize:function(a){var c=d._computeSize(a),f=b("#wallpaper"),g=b("#wallpaper_content");if(0<a.length){if("window"==e.fitting){var h=b(window).height();g.css({height:h});a.css({top:-c.top})}else{var j=b(document).height(),i=b(window).height(),h=g.outerHeight(!0);h<j&&(h=j);i>h&&(h=i)}a.css({height:c.height,width:c.width,left:-c.left, top:-c.top});f.css({height:h})}},_computeSize:function(a){var c=b(window).width(),f="document"==e.fitting?b(document).height():b(window).height(),g=a[0].width,a=a[0].height,h=g/a,d=0,i=0,a=f,g=a*h;g<c&&(g=c,a=g/h);d=(g-c)/2;i=(a-f)/2;"window"==e.fitting&&0<b(document).scrollLeft()&&(d+=b(document).scrollLeft());return{width:parseInt(g,10),height:parseInt(a,10),left:parseInt(d,10),top:parseInt(i,10)}}};b.wallpaper=function(a){if(d[a])return d[a].apply(this,Array.prototype.slice.call(arguments,1)); if("object"===typeof a||!a)return d.init.apply(this,arguments);b.error("WALLPAPER: '"+a+"' does not exist.")}})(jQuery);